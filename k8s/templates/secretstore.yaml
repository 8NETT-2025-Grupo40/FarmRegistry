# SecretStore: define como conectar ao provedor de secrets (AWS Secrets Manager)
# Usado pelo ExternalSecret para buscar os valores dos secrets
# 
# Autenticação via IRSA (IAM Roles for Service Accounts):
# - ServiceAccount tem annotation com ARN da role IAM
# - Role IAM tem policy de acesso ao Secrets Manager (ex: FarmRegistryAPIPolicy)
# - External Secrets Operator usa isso para assumir a role e acessar secrets
apiVersion: external-secrets.io/v1
kind: SecretStore
metadata:
  name: {{ include "farm-registry-api.fullname" . }}-secretstore
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "farm-registry-api.labels" . | nindent 4 }}
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-east-1
      auth:
        jwt:  # autenticação via IRSA (ServiceAccount com role IAM)
          serviceAccountRef:
            name: {{ include "farm-registry-api.serviceAccountName" . }}
